{% extends "templates/partials/base.html" %}

{% import "templates/partials/row-cards.html" as row %}

{% block title %}{% parent %} - {{ item.name }}{% endblock %}

{% block content %}
<article id="output-{{ item.slug }}" class="bg-white">

  <section id="project-body" class="bg-light bg-white-xs">
  <div class="container-fluid">

    <div class="row">

      <div id="sidebar" class="sidebar col-sm-3 hidden-xs" aside-enter>
      {% set page = "output-item" %}
      {% include "templates/partials/aside.html" %}
      </div>

      <div class="col-sm-9 bg-white pb2 pt1">

       <div class="row padded">
          <div class="col-xs-offset-1 col-xs-10 centered-xs">
            <h6 class="uppercase bold">
                {% if item.publication_date %}
                    {{ item.publication_date|date('F Y') }}
                {% else %}
                    {{ item.publish_date|date('F Y') }}
                {% endif %}
            </h6>
            <h2 class="project-title bold">{{ item.name }}{% if item.subtitle%}:{% endif %}</h2>
            {% if item.subtitle%}<h3 class="italic">{{ item.subtitle }}</h>{% endif %}
          </div>
        </div>

        <div class="row mb2">
          <div class="col-xs-offset-1 col-xs-10 centered-xs">
            <h4 class="project-summary">{{ item.summary }}</h4>
          </div>
        </div>

        <div class="row {% if !item.image %} mb2{% endif %}">

            <div class="projects-rule"></div>

        </div>

        {% set image = item.image %}

        <div class="row {% if !image.caption %}mb2{% endif %}">

              <img src="{{ image|imageCrop(1000,500) }}">

        </div>

        {% if image.caption %}
        <div class="row mb2">
            <div class="col-sm-offset-6 col-sm-5">
                <p class="caption gray righted p-min">{{ image.caption }}</p>
            </div>
        </div>
        {% endif %}


        <div class="row pb4">
          <div class="col-xs-offset-1 col-xs-10 wysiwyg">
            {{ item.description|safe }}
          </div>
        </div>

        {% if item.file || item.link %}
            {% if item.file %}
                <div class="col-xs-offset-1 col-xs-5 pb6 centered">
                    <a target="_blank" class="sync output-link" type="{{ item.file.type }}" href="{{ item.file.url }}">Download Content</a>
                    <script>console.log({{ item.file|json|safe }});</script>
                </div>
            {% endif %}
            {% if item.link %}
                <div class="{% if !item.file %}col-xs-offset-6 {% endif %} col-xs-5 bg-white pb6 centered">
                    <a target="_blank" class="sync output-link" href="{{ item.link }}">View Link</a>
                </div>
            {% endif %}
        {% endif %}

      </div>
    </div>
  </div>
  </section>

  {% if ( item.related_projects.length || item.related_updates.length || item.related_research.length ) %}
  <section id="project-related" class="bg-light">
  <div class="container-fluid">
        <div class="row">

          <div class="col-sm-offset-3 col-sm-9 bg-white pb4">
            <div class="row">
              <div class="col-xs-offset-1 col-xs-10 mb2" >
                <div class="projects-rule"></div>
            <h4>Related {% if item.related_projects %}Project{{ item.related_projects|pluralize('s')}} {% if item.related_updates %} and {% endif %} {% endif %} {% if item.related_updates %}Update{{ item.related_updates|pluralize('s') }}{% endif %}</h4>
              </div>
            </div>

            <div class="row">
            <ul class="mb2">

                {{ row.reverse_chronological( merge(item.related_projects,item.related_research,item.related_updates) ) }}

            </ul>
            </div>

          </div>

        </div>
  </div>
  </section>
  {% endif %}

</article>

{% set returnTo = {to: "Research", url: "/output", aside: true } %}
{% include 'templates/partials/prefooter.html' %}

{% endblock %}
